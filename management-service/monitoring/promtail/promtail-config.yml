server:
	http_listen_port: 9080
	grpc_listen_port: 0

positions:
	filename: /tmp/positions.yaml

clients:
	- url: http://loki:3100/loki/api/v1/push

scrape_configs:
	- job_name: docker-logs
		docker_sd_configs:
			- host: unix:///var/run/docker.sock
			  refresh_interval: 5s
		relabel_configs:
			- target_label: job
			  replacement: docker
			- target_label: host
			  replacement: ${HOSTNAME}
			- source_labels: [__meta_docker_container_name]
			  target_label: container
			  regex: \/(.*)
			- source_labels: [__meta_docker_container_id]
			  target_label: container_id
			- source_labels: [__meta_docker_container_id]
			  target_label: __path__
			  replacement: /var/lib/docker/containers/$1/*-json.log
			- source_labels: [__meta_docker_container_label_com_docker_compose_service]
			  target_label: service_name
			- source_labels: [__meta_docker_container_label_com_docker_compose_service]
			  target_label: compose_service
			- source_labels: [__meta_docker_container_label_com_docker_compose_project]
			  target_label: compose_project
			- source_labels: [__meta_docker_container_label_com_docker_compose_container_number]
			  target_label: compose_container_number
			- source_labels: [__meta_docker_container_log_stream]
			  target_label: stream
			- source_labels: [__meta_docker_network_ip]
			  target_label: container_ip
		pipeline_stages:
			- docker: {}


